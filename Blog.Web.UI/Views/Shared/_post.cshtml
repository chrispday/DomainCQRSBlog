@model Blog.ReadModel.Data.PublishedPost
<div class="post" ng-controller="commentsController">
	<div class="page-header">
		<h3><a href="/Post/@Model.Url">@Model.Title</a></h3>
		<div class="row">
			<div class="col-md-6">
				<i class="icon-time"></i>&nbsp;@Model.WhenPublished.ToString("dddd, dd" + Blog.Web.UI.Helper.TwoLetterSuffix(Model.WhenPublished) + " MMMM yyyy")
			</div>
			<div class="col-md-6">
				<a href="#comments-@Model.Id"><i class="icon-comments-alt"></i>&nbsp;Comments <span class="badge postTotalComments" ng-init="totalComments = @Model.TotalComments" ng-cloak>{{totalComments}}</span></a>
			</div>
		</div>
	</div>
	<div>@Html.Raw(Model.Content)</div>
	<div>&nbsp;</div>
	<div class="panel panel-default postCommentsPanel">
		<div class="panel-body">
			<form ng-submit="addNewComment()" role="form" class="form-horizontal addCommentForm">
				<div class="form-group" ng-show="showNewComment">
					<label for="Name" class="col-md-1 control-label">Name</label>
					<div class="col-md-11">
						<input ng-model="newComment.Name" focus-when="showNewComment" type="text" class="form-control" id="Name" name="Name" placeholder="Name" required />
					</div>
				</div>
				<div class="form-group" ng-show="showNewComment">
					<label for="Email" class="col-md-1 control-label">Email</label>
					<div class="col-md-11">
						<input ng-model="newComment.Email" ng-blur="setNewCommentEmailHash()" type="email" class="form-control commentEmail" id="Email" name="Email" placeholder="Email" required />
					</div>
				</div>
				<div class="form-group" ng-show="showNewComment">
					<div class="col-md-offset-1 col-md-11">
						<div class="checkbox">
							<label>
								<input ng-model="newComment.ShowEmail" type="checkbox" id="ShowEmail" name="ShowEmail" />
								Show Email</label>
						</div>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-1 hidden-xs">
						<img ng-src="http://www.gravatar.com/avatar/{{newComment.EmailHash}}?d=mm&s=60" class="img-thumbnail commentAvatar" height="60" width="60" style="min-width: 60px;" />
					</div>
					<div class="col-md-11">
						<textarea ng-model="newComment.CommentText" ng-focus="showNewComment = true" class="form-control commentText" id="CommentText" name="CommentText" rows="2" placeholder="Comment..." required></textarea>
					</div>
				</div>
				<div class="form-group" ng-show="showNewComment">
					<div class="col-md-offset-1 col-md-11">
						<div recaptcha ng-model="newComment.Validation.RecaptchaId" show-when="showNewComment" key="6LdJ_-cSAAAAABSQ03vab49RBrBYXyiovv8ncnbp" theme="clean" id="newCommentRecaptcha-@Model.Id">
						</div>
						<div class='text-danger' ng-show="newComment.Validation.RecaptchaError"><label>{{newComment.Validation.RecaptchaError}}</label></div>
					</div>
				</div>
				<div class="form-group" ng-show="showNewComment">
					<input ng-model="newComment.Id" type="hidden" name="Id" id="Id" />
					<input ng-model="newComment.PostId" ng-init="newComment.PostId = '@Model.Id'" type="hidden" name="PostId" id="PostId" />
					<div class="col-md-offset-1 col-md-11">
						<div class='text-danger' ng-show="newComment.Validation.AddCommentError"><label>{{newComment.Validation.AddCommentError}}</label></div>
						<button type="submit" class="btn btn-primary addComment">Add Comment</button>
					</div>
				</div>
			</form>
		</div>
		<div class="panel-heading">
			<a id="comments-@Model.Id"></a>
			<a class="viewComments" href ng-click="showComments('@Model.Id')"><i class="icon-comments-alt"></i>&nbsp;View Comments <span class="badge postTotalComments" ng-cloak>{{totalComments}}</span></a>
			@Html.Hidden("postId", Model.Id, new { Class = "postId" })
		</div>
		<p class='text-center' ng-show="showSpinner"><i class='icon-spinner icon-3x icon-spin'></i></p>
		<div class="panel-body postComments" ng-show="comments.length">
			<div class="row" ng-repeat="comment in comments">
				<div class="col-md-1 hidden-xs">
					<img class="img-thumbnail" src="http://www.gravatar.com/avatar/{{comment.EmailHash}}?d=mm&s=60" height="60" width="60" style="min-width: 60px;" />
				</div>
				<div class="col-md-11">
					<p>
						<span ng-show="comment.ShowEmail"><a href="mailto:{{comment.Email}}">{{comment.Name}}</a></span>
						<span ng-show="!comment.ShowEmail">{{comment.Name}}</span>
						at {{ comment.WhenCommented | momentFormat:'D-MMM-YYYY h:mma' }}
					</p>
					<p>{{comment.CommentText}}</p>
					<p>&nbsp;</p>
				</div>
			</div>
		</div>
	</div>
</div>
